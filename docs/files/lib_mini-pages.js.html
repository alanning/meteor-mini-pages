<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib&#x2F;mini-pages.js - mini-pages</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="mini-pages"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/PageRouter.html">PageRouter</a></li>
            
                <li><a href="..&#x2F;classes/PageRouter.Page.html">PageRouter.Page</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib&#x2F;mini-pages.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function () {

  var sessionLayoutKey = &quot;mini-pages-router_layout&quot;;
  var sessionTemplateKey = &quot;mini-pages-router_template&quot;;
  var sessionNavKey = &quot;mini-pages-router_nav&quot;;

  function getTemplate (name) {
    if (!Template[name])
      throw new Error(
        &quot;Couldn&#x27;t find template named &quot; + name + &quot;. Are you sure you defined it?&quot;
      );

    return Template[name];
  }

  function defaultValue (original, value) {
    return typeof original === &#x27;undefined&#x27; ? value : original;
  }

  &#x2F;**
  The main mini-pages class. Manages creating pages, rendering and 
  responding to url path changes. You can only create one PageRouter instance.
  
  @class PageRouter
  @constructor
  @optional
  @param {Object} [options] PageRouter options
   @param {Boolean} [options.autoRender] Set &#x60;false&#x60; to render manually 
   (i.e. when you use the {{renderPage}} Handlebars helper
   @param {Boolean} [options.autoStart] Set to &#x60;false&#x60; to manually decide 
   when to listen for url change events.
  *&#x2F; 
  var PageRouter = function (options) {
    
    if (Meteor.router)
      throw new Error(&quot;Only one instance of PageRouter is allowed.&quot;);

    if (!(this instanceof PageRouter))
      return new PageRouter(options);

    Meteor.router = this;

    options = _.extend({
      autoRender: true,
      autoStart: true
    }, options);

    this._currentPath = null;

    if (options.autoStart) this.autoStart();
    if (options.autoRender) this.autoRender();
  };

  PageRouter.prototype = {
    constructor: PageRouter,

    &#x2F;**
      Map urls to pages.

      @example
          var router = new Meteor.PageRouter({});
          router.pages({
           &quot;&#x2F;posts&#x2F;:_id&quot;: {
              to: &quot;templateName&quot;,
              layout: &quot;layoutName&quot;,
              nav: &quot;nav key&quot;,
              before: [ before callbacks ],
              as: &quot;path helpers name&quot;
           }
          });

       @method pages
       @chainable
       @param {Object} pages An object of page definitions where the key is a
       url path and the values are options to the 
       {{#crossLink &quot;PageRouter.Page&quot;}}{{&#x2F;crossLink}} constructor.
    *&#x2F;
    pages: function (pages) {
      var self = this;
      _.each(pages, function (options, path) {
        self.match(path, options);
      });
      return self;
    },

    match: function (path, options) {
      return new PageRouter.Page(this, path, options);
    },

    go: function (path, state) {
      page(path, state);
    },

    autoStart: function () {
      Meteor.startup(_.bind(this.start, this));
    },

    start: function () {
      page();
    },

    autoRender: function () {
      var self = this;
      Meteor.startup(function () {
        var renderRouter = _.bind(self.render, self),
            frag;

        frag = Meteor.render(renderRouter);
        document.body.appendChild(frag);
      });
    },

    render: function () {
      var router = this,
          page;

      page = function () {
        var layout, 
            layoutName = router.layout();

        if (_.isUndefined(layoutName) &amp;&amp; Template[&quot;layout&quot;])
          layout = Template[&quot;layout&quot;];
        else if (_.isString(layoutName))
          layout = getTemplate(layoutName);
        else
          layout = function (data) { return data[&quot;yield&quot;](); };

        return layout({
          &quot;yield&quot;: function () {
            return Spark.isolate(function () {
              var templateName = router.template(),
                  template;

              template = templateName ? getTemplate(templateName) :
                function () { return &quot;&quot;; };

              return Spark.isolate(template);
            });
          }
        });
      };

      return Spark.isolate(page);
    },

    run: function (path, page, context) {
      var invocation;

      if (path == this._currentPath) return;

      invocation = page.run(context);

      if (invocation.stopped)
        return;
      else {
        this.layout(invocation.layout());
        this.template(invocation.template());
        this.nav(invocation.nav());
      }
    },

    layout: function (value) {
      if (typeof value !== &#x27;undefined&#x27;)
        Session.set(sessionLayoutKey, value);
      else
        return Session.get(sessionLayoutKey);
    },

    template: function (value) {
      if (typeof value !== &#x27;undefined&#x27;)
        Session.set(sessionTemplateKey, value);
      else
        return Session.get(sessionTemplateKey);
    },

    nav: function (value) {
      if (typeof value !== &#x27;undefined&#x27;)
        Session.set(sessionNavKey, value);
      else
        return Session.get(sessionNavKey);
    },

    path: function () {
      return this._currentPath;
    }
  };

  &#x2F;**
    Stores information about a specific route.
  
    @class PageRouter.Page
    @constructor
    @protected
  *&#x2F; 
  PageRouter.Page = function (router, path, options) {
    var self = this;

    self.router = router;
    self.path = path;
    self._beforeCallbacks = [];

    if (_.isFunction(options)) {
      options = { before: options };
    }
    else if (_.isString(options)) {
      options = { to: options };
    }

    if (!_.isUndefined(options.before)) self.before(options.before);
    if (!_.isUndefined(options.nav)) self.nav(options.nav);
    if (!_.isUndefined(options.to)) self.to(options.to);
    if (!_.isUndefined(options.layout)) self.layout(options.layout);

    var onPageRoute = function (context, next) {
      self.router.run(context.path, self, context);
    };

    page(path, onPageRoute);
  };

  PageRouter.Page.prototype = {
    constructor: PageRouter.Page,

    to: function (template) {
      this.defaultTemplate = template;
      return this;
    },

    nav: function (nav) {
      this.defaultNav = nav;
      return this;
    },

    layout: function (layout) {
      this.defaultLayout = layout;
      return this;
    },

    before: function (callbacks) {
      callbacks = _.isArray(callbacks) ? callbacks : [callbacks];
      this._beforeCallbacks.concat(callbacks);
    },

    run: function (context) {
      var invocation,
          callbacks = this._beforeCallbacks,
          template,
          nav,
          layout;

      invocation = new PageInvocation(this.router, this, context);

      for (var i = 0; i &lt; callbacks.length; i++) {
        if (invocation.stopped) break;
        callbacks[i].call(invocation);
      }

      invocation.layout(defaultValue(invocation.layout(), this.defaultLayout));
      invocation.template(
        defaultValue(invocation.template(), this.defaultTemplate)
      );
      invocation.nav(defaultValue(invocation.nav(), this.defaultNav));

      return invocation;
    }
  };

  var PageInvocation = function (router, page, context) {
    this.context = context;
    this.params = context.params || {};
    this.router = router;
    this.page = page;
    this.stopped = false;
  };

  PageInvocation.prototype = {
    constructor: PageInvocation,

    layout: function (value) {
      if (typeof value !== &#x27;undefined&#x27;)
        this._layout = value;
      else
        return this._layout;
    },

    template: function (value) {
      if (typeof value !== &#x27;undefined&#x27;)
        this._template = value;
      else
        return this._template;
    },

    nav: function (value) {
      if (typeof value !== &#x27;undefined&#x27;)
        this._nav = value;
      else
        return this._nav;
    },

    redirect: function (path, options) {
      this.stop();
      this._router.go(path, options);
    },

    stop: function () {
      this.stopped = true;
      this.context.stop();
    }
  };

  _.extend(Meteor, {
    pages: function (pages) {
      return new PageRouter().pages(pages);
    },

    PageRouter: PageRouter,

    go: function (path, state) {
      page(path, state);
    }
  });
}());

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
